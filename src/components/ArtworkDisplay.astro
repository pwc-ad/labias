---
import { type Artwork } from '@/constants/artworks';
import ArtworkDisplayHeader from './ArtworkDisplayHeader.astro';
import ArtworkInfoPanel from './ArtworkInfoPanel.astro';
import ArtworkDisplayInteractive from './ArtworkDisplayInteractive.astro';
import ArtworkDisplayFactory from './ArtworkDisplayFactory.astro';

interface Props {
	artwork: Artwork;
	artworkContent?: any;
	className?: string;
}

const { artwork, artworkContent, className } = Astro.props;
---

<section class={`flex flex-col ${className}`}>
	<ArtworkDisplayHeader
		artwork={artwork}
		fullscreenTargetId="artwork-display"
	/>
	<div class="group relative flex-1" id="artwork-display-wrapper">
		<div class="absolute inset-0 flex overflow-clip">
			<div
				class="relative h-full w-full min-w-full overflow-clip transition-transform duration-600 group-[.info-open]:-translate-x-60 sm:group-[.info-open]:-translate-x-80"
			>
				<div
					class="relative h-full w-[100vw] transition-transform duration-500 group-[.info-open]:translate-x-30 sm:group-[.info-open]:translate-x-40"
				>
					<div id="artwork-display">
						<ArtworkDisplayFactory artwork={artwork} />
					</div>
				</div>
				<!-- <img src="/poster.jpg" class="absolute inset-0 w-full h-full object-cover" /> -->
				{
					artwork.metadata.type === 'interactive' && (
						<ArtworkDisplayInteractive artwork={artwork} />
					)
				}
				<div
					class="absolute top-0 right-0 h-full w-[80vw] max-w-120 translate-x-full transition-transform duration-400 group-[.info-open]:translate-x-0"
				>
					<ArtworkInfoPanel
						artwork={artwork}
						artworkContent={artworkContent}
					/>
				</div>
			</div>
		</div>
		<script>
			(function () {
				const infoToggleButtons =
					document.querySelectorAll('[data-info-toggle]');
				const artworkDisplayWrapper = document.querySelector(
					'#artwork-display-wrapper'
				);
				infoToggleButtons.forEach((infoToggleButton) => {
					infoToggleButton.addEventListener('click', () => {
						artworkDisplayWrapper?.classList.toggle('info-open');
						infoToggleButtons.forEach((btn) => {
							const activeClass =
								btn.getAttribute(
									'data-info-toggle-active-class'
								) || 'active';
							btn.classList.toggle(
								activeClass,
								artworkDisplayWrapper?.classList.contains(
									'info-open'
								) || false
							);
						});
					});
				});
			})();
		</script>
	</div>
</section>
