---
import { type GalleryMetadata } from '@/constants/artworks';

interface Props {
	metadata: GalleryMetadata;
}

const { metadata } = Astro.props;
const { images } = metadata;
const id = `gallery-${Math.random().toString(36).slice(2, 9)}`;
const hasMultiple = images.length > 1;
---

<div
	id={id}
	class="absolute inset-0 h-full w-full overflow-hidden bg-black py-2"
>
	<div
		id={`${id}-slider`}
		class="hide-scrollbar flex h-full w-full snap-x snap-mandatory items-center overflow-x-auto scroll-smooth"
	>
		{
			images.map((image) => (
				<div class="flex h-full w-full shrink-0 snap-center items-center justify-center">
					<img
						src={image.url}
						alt={image.alt ?? ''}
						class="h-full w-full cursor-zoom-in object-contain"
						onclick={`(()=>{const lb=document.getElementById('lightbox');const img=document.getElementById('lightbox-img');if(!lb||!img)return;img.src='${image.url}';lb.classList.remove('hidden');lb.classList.add('flex');const close=()=>{lb.classList.add('hidden');lb.classList.remove('flex');document.removeEventListener('keydown',esc)};const esc=(e)=>{if(e.key==='Escape')close();};lb.onclick=close;document.addEventListener('keydown',esc);})()`}
					/>
				</div>
			))
		}
	</div>

	<!-- Flecha de avance -->
	{
		hasMultiple && (
			<button
				type="button"
				aria-label="Siguiente imagen"
				class="absolute top-1/2 right-4 z-10 hidden -translate-y-1/2 cursor-pointer p-3 text-black hover:scale-120 md:flex"
				onclick={`(()=>{const s=document.getElementById("${id}-slider");if(!s)return;const slides=s.querySelectorAll("div");if(!slides.length)return;const w=s.clientWidth;const idx=Math.round(s.scrollLeft/w);const next=(idx+1)%slides.length;s.scrollTo({left:next*w,behavior:'smooth'});})()`}
			>
				<span aria-hidden="true" class="text-5xl">
					â€º
				</span>
			</button>
		)
	}

	<!-- Lightbox overlay -->
	<div
		id="lightbox"
		class="fixed inset-0 z-50 hidden items-center justify-center bg-black/90"
	>
		<img
			id="lightbox-img"
			src=""
			alt=""
			class="max-h-[90vh] max-w-[90vw] object-contain"
		/>
	</div>
</div>

<!-- Scrollbar oculto -->
<style>
	.hide-scrollbar::-webkit-scrollbar {
		display: none;
	}
	.hide-scrollbar {
		-ms-overflow-style: none;
		scrollbar-width: none;
	}
</style>
