---
import { type GalleryMetadata } from '@/constants/artworks';

interface Props {
  metadata: GalleryMetadata;
}

const { metadata } = Astro.props;
const { images } = metadata;
const id = `gallery-${Math.random().toString(36).slice(2, 9)}`;
const hasMultiple = images.length > 1;
---

<div id={id} class="absolute inset-0 w-full py-2 h-full overflow-hidden bg-black">
  <div
    id={`${id}-slider`}
    class="flex h-full w-full items-center snap-x snap-mandatory overflow-x-auto scroll-smooth hide-scrollbar"
  >
    {images.map((image) => (
      <div class="shrink-0 w-full h-full snap-center flex items-center justify-center">
        <img
          src={image.url}
          alt={image.alt ?? ""}
          class="object-contain w-full h-full cursor-zoom-in"
          onclick={`(()=>{const lb=document.getElementById('lightbox');const img=document.getElementById('lightbox-img');if(!lb||!img)return;img.src='${image.url}';lb.classList.remove('hidden');lb.classList.add('flex');const close=()=>{lb.classList.add('hidden');lb.classList.remove('flex');document.removeEventListener('keydown',esc)};const esc=(e)=>{if(e.key==='Escape')close();};lb.onclick=close;document.addEventListener('keydown',esc);})()`}
        />
      </div>
    ))}
  </div>

  <!-- Flecha de avance -->
  {hasMultiple && (
    <button
      type="button"
      aria-label="Siguiente imagen"
      class="absolute cursor-pointer hover:scale-120 right-4 top-1/2 -translate-y-1/2 text-black p-3 z-10 hidden md:flex"
      onclick={`(()=>{const s=document.getElementById("${id}-slider");if(!s)return;const slides=s.querySelectorAll("div");if(!slides.length)return;const w=s.clientWidth;const idx=Math.round(s.scrollLeft/w);const next=(idx+1)%slides.length;s.scrollTo({left:next*w,behavior:'smooth'});})()`}
    >
      <span aria-hidden="true" class="text-5xl">â€º</span>
    </button>
  )}

  <!-- Lightbox overlay -->
  <div
    id="lightbox"
    class="fixed inset-0 bg-black/90 hidden items-center justify-center z-50"
  >
    <img id="lightbox-img" src="" alt="" class="max-h-[90vh] max-w-[90vw] object-contain" />
  </div>
</div>

<!-- Scrollbar oculto -->
<style>
  .hide-scrollbar::-webkit-scrollbar { display: none; }
  .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
</style>
