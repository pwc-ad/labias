---
import type { GetStaticPaths } from "astro";
import Layout from '../layouts/Layout.astro';
import labiaLogo from '../assets/labias.svg';
import Logo from '@/components/Logo.astro';
import ArtworkList from '@/components/ArtworkList.astro';
import { artworks } from '@/constants/artworks';

export const getStaticPaths = (() => {
	return artworks.map((artwork) => ({
		params: { artwork: artwork.slug },
	}));
});

const { artwork: artworkSlug } = Astro.params;
const artwork = artworks.find((art) => art.slug === artworkSlug);
const { title, author } = artwork || {};
const artworkSlugs = artworks.map((art) => art.slug);
const currentArtworkSlug = artwork?.slug;
---

<Layout>
	<div class="px-3 mx-auto min-h-full flex flex-col-reverse justify-between">
		<!-- <canvas id="background" class="fixed -z-1 inset-0"></canvas> -->
		<header class="p-6 pt-4 flex justify-between items-end">
			<div class="text-3xl text-accent">
				<Logo />
			</div>
			<button id="next-artwork" class="font-bold cursor-pointer lowercase border border-gray-200 hover:bg-accent hover:border-accent hover:text-gray-50 px-5 py-1 rounded-full">
				Visit next 
			</button>
		</header>
		<section class="flex-1 flex flex-col">
			<header class="px-6 py-6 flex items-center gap-3">
				<h1 class="text-2xl font-bold tracking-tight">{title}</h1>
				<p class="text-lg">({author}, 2025)</p>
			</header>
			<div class="flex-1 bg-black rounded-sm overflow-clip relative">
				<!-- <img src="/poster.jpg" class="absolute inset-0 w-full h-full object-cover" /> -->
				 <!-- <iframe src="https://radicalsoftware.xyz/labs/en/vertex-sphere/" class="absolute w-full h-full"></iframe> -->
				<!-- <video controls src="/video/video.mp4" autoplay loop muted class="absolute inset-0 w-full h-full object-contain"></video> -->
			</div>
		</section>
	</div>
	<div class="h-1/2 p-3">
		<div class="p-6 flex flex-col gap-30 pb-20">
			<article>
				<h2 class="font-bold tracking-tight text-xl my-8">Artworks</h2>
				<ArtworkList artworks={artworks} />
			</article>
			<article class="flex flex-col items-end text-end">
				<h2 class="font-bold tracking-tight text-xl my-8">About / Credits</h2>
				<div class="max-w-3xl text-sm flex flex-col gap-5 leading-6">
					<p><i class="text-accent font-bold not-italic">Labias</i> is a pavilion of <b class="font-semibold">The Wrong Biennale</b>, curated by <b class="font-semibold">Ignacio Guerra</b> in collaboration with <b class="font-semibold">Jos√© Casanova</b>.</p>
					<p>The project was developed by the study group <b class="font-semibold">Programaci√≥n Web Creativa y Arte Digital (UNTREF)</b>, with the support of the <b class="font-semibold">Laboratorio de Arte Electr√≥nico e Inteligencia Artificial (UNTREF)</b> and the <b class="font-semibold">Diplomatura en Inteligencia Artificial aplicada al Arte Multimedial (UNA)</b>.</p>
					<p>Special thanks to all the artists whose work made this pavilion possible.</p>
					<p>Made width ‚ù§Ô∏è from üá¶üá∑</p>
				</div>
			</article>
		</div>
	</div>
	<script define:vars={{ artworkSlugs, currentArtworkSlug }}>
		window._artworkSlugs = artworkSlugs;
		window._currentArtworkSlug = currentArtworkSlug;
	</script>
	<script>
		import { getTour, saveTour } from "@/utils/tour-manager";
		import { generateArtworkUrl } from "@/utils/url-generator";
		
		const artworkSlugs = window._artworkSlugs;
		const currentArtworkSlug = window._currentArtworkSlug;

		const tour = getTour(artworkSlugs);
		tour.markVisited(currentArtworkSlug);
		saveTour(tour);

		tour.visitedSlugs.forEach((slug) => {
			const linkElement = document.querySelector(`a[href='${generateArtworkUrl(slug)}']`);
			linkElement?.classList.add('visited');
		});
		
		const nextArtworkButton = document.getElementById('next-artwork');
		nextArtworkButton?.addEventListener('click', () => {
			const nextArtworkSlug = tour.getNextArtworkSlug(currentArtworkSlug);
			if (nextArtworkSlug) {
				window.location.href = generateArtworkUrl(nextArtworkSlug);
			} else {
				console.error('No next artwork found');
			}
		});
	</script>
</Layout>
